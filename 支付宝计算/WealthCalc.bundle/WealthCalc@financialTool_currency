{"time":"0049","tplId":"WealthCalc@financialTool_currency","publishVersion":"151217","tag":"WealthCalc","name":"financialTool_currency","data":{"tag":"html","children":[{"tag":"head","children":[{"content":"text/html; charset=UTF-8","tag":"meta","http-equiv":"Content-Type"},{"tag":"meta","src":"WealthCalc.bundle/financial.i18n","type":"i18n"},{"tag":"meta","src":"android-phone-wallet-wealthcalc/financial.i18n","type":"i18n"},{"tag":"style","children":[{"text":"div {\n            display: flex;\n            flex-direction: row;\n            position: relative;\n        }","tag":"text"}]},{"tag":"script","children":[{"text":"var currencyUpdateTime = \"\";\n\n        var arrOldValue = new Array();\n        arrOldValue.push(\"\");\n        arrOldValue.push(\"\");\n\n        var arrName = new Array();\n        var arrRate = new Array();\n        var arrIcon = new Array();\n        var arrIconCode = new Array();\n\n        var focus_index = 1;\n\n        var arrIndex = new Array();\n        arrIndex.push(1);\n        arrIndex.push(0);\n\n        var arrInput = new Array();\n        var arrLabel = new Array();\n        var arrImg = new Array();\n\n        var is_loaded = false;\n\n        var WealthCalc_bundle = \"WealthCalc.bundle/\";\n        var UICommon_bundle = \"APCommonUI.bundle/\";\n        if (document.platform == \"android\") {\n            WealthCalc_bundle = \"android-phone-wallet-wealthcalc/com.alipay.mobile.wealthtools.app/\";\n            UICommon_bundle = \"android-phone-wallet-wealthcalc/com.alipay.mobile.wealthtools.app/\";\n        }\n\n        function fmoney(s) {\n            var l = s.split(\".\")[0].split(\"\").reverse();\n\n            r = s.split(\".\")[1];\n            t = \"\";\n\n            for (i = 0; i < l.length; i++) {\n                t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? \",\" : \"\");\n            }\n\n            var ret = t.split(\"\").reverse().join(\"\");\n            if (r != undefined) {\n                ret = ret + \".\" + r;\n            }\n\n            return ret;\n        }\n\n        function saveOldValue(money) {\n            var ret = money.toFixed(4).toString();\n            var l = ret.split(\".\")[0];\n            if (l.length > 9) {\n                ret = \"\";\n            }\n\n            return ret;\n        }\n\n        function input_money(index) {\n\n            if (is_loaded == false)\n                return;\n\n            var s_newValue = arrInput[index].value;\n\n            s_newValue = s_newValue.replace(/,/g, '');\n\n            if (s_newValue == \".\")\n                s_newValue = \"0.\";\n\n            if (s_newValue == \"\") {\n                arrOldValue[index] = \"\";\n                arrInput[1 - index].value = \"0\";\n                return;\n            }\n\n            var reg = \"^(([1-9]{1}\\\\d{0,8})|([0]{1}))(\\\\.(\\\\d){0,4})?$\";\n            var r = s_newValue.match(reg);\n            if (r == null) {\n\n                arrInput[index].value = fmoney(arrOldValue[index]);\n\n                if (arrOldValue[index] == \"\")\n                    input_money(index);\n            } else {\n\n                arrOldValue[index] = s_newValue;\n                arrInput[index].value = fmoney(s_newValue);\n\n                var money = parseFloat(s_newValue) * arrRate[arrIndex[index]] / arrRate[arrIndex[1 - index]];\n                arrInput[1 - index].value = fmoney(money.toFixed(4));\n\n                arrOldValue[1 - index] = saveOldValue(money);\n            }\n        }\n\n        function money_input_a() {\n\n            input_money(0);\n        }\n\n        function money_input_b() {\n\n            input_money(1);\n        }\n\n        function switch_country(click_index) {\n\n            if (is_loaded == false)\n                return;\n\n            var obj = {\n                'btns': arrName,\n                'default': arrIndex[click_index],\n                'title': ''\n            };\n\n            var label = arrLabel[click_index];\n            var img = arrImg[click_index];\n\n            document.picker(obj, function (data) {\n\n                var index = data.index;\n                label.innerText = arrName[index];\n                if (arrIcon[index].length <= 0) {\n                    if (document.platform == \"android\") {\n                        img.src = WealthCalc_bundle + arrIconCode[index].toLowerCase();\n                    } else {\n                        img.src = WealthCalc_bundle + arrIconCode[index];\n                    }\n                } else {\n                    img.src = arrIcon[index];\n                }\n\n                arrIndex[click_index] = index;\n\n                var s_newValue = arrInput[focus_index].value;\n                s_newValue = s_newValue.replace(/,/g, '');\n\n                if (s_newValue.length > 0) {\n\n                    var money = parseFloat(s_newValue) * arrRate[arrIndex[focus_index]] / arrRate[arrIndex[1 - focus_index]];\n                    arrInput[1 - focus_index].value = fmoney(money.toFixed(4));\n\n                    arrOldValue[1 - focus_index] = saveOldValue(money);\n                }\n\n                arrInput[focus_index].focus();\n\n                var rate = (arrRate[arrIndex[0]] / arrRate[arrIndex[1]]).toFixed(4);\n\n                document.setProp(\"userPreferences\", {\n                    \"key\": \"WealthCalc_yuedongweng_currency_index\",\n                    \"business\": \"WealthCalc\",\n                    \"data\": {\n                        \"name_a\": arrLabel[0].innerText,\n                        \"name_b\": arrLabel[1].innerText\n                    }\n                });\n\n                document.getElementById(\"bottom_label\").innerText = \"1\" + arrLabel[0].innerText + \" = \" + rate + arrLabel[1].innerText + \",\" + \" {{更新于}} \" + currencyUpdateTime;\n\n            });\n\n        }\n\n        function focus_deal(index) {\n\n            print(\"focus\");\n\n            focus_index = index;\n            if (arrInput[focus_index].value == \"0\") {\n                arrInput[focus_index].value = \"\";\n                arrInput[1 - focus_index].value = \"0\";\n            }\n        }\n\n        function change_a() {\n            switch_country(0);\n\n            document.invoke(\"log\", {\n                \"actionId\": \"clicked\",\n                \"extParams\": null,\n                \"appId\": \"20000150\",\n                \"seed\": \"currency1\",\n                \"ucId\": \"UC-HLHS-01\"\n            });\n        }\n\n        function change_b() {\n            switch_country(1);\n\n            document.invoke(\"log\", {\n                \"actionId\": \"clicked\",\n                \"extParams\": null,\n                \"appId\": \"20000150\",\n                \"seed\": \"currency2\",\n                \"ucId\": \"UC-HLHS-02\"\n            });\n        }\n\n        function focus_a() {\n            focus_deal(0);\n\n            document.invoke(\"log\", {\n                \"actionId\": \"clicked\",\n                \"extParams\": null,\n                \"appId\": \"20000150\",\n                \"seed\": \"currencyAmount1\",\n                \"ucId\": \"UC-HLHS-03\"\n            });\n        }\n\n        function focus_b() {\n            focus_deal(1);\n\n            document.invoke(\"log\", {\n                \"actionId\": \"clicked\",\n                \"extParams\": null,\n                \"appId\": \"20000150\",\n                \"seed\": \"currencyAmount2\",\n                \"ucId\": \"UC-HLHS-04\"\n            });\n        }\n\n        function init_ui(bizResult, noReset) {\n            if (!noReset) {\n                arrName = new Array();\n                arrRate = new Array();\n                arrIcon = new Array();\n                arrIconCode = new Array();\n            }\n            is_loaded = true;\n\n            currencyUpdateTime = bizResult.currencyUpdateTime;\n\n            var data = bizResult;\n\n            var list = data[\"currencyRateList\"];\n            for (var i = 0; i < list.length; i++) {\n\n                arrName.push(list[i].currencyName);\n                arrRate.push(parseFloat(list[i].rate));\n                arrIcon.push(list[i].iconUrl);\n                arrIconCode.push(list[i].currencyCode);\n            }\n\n            var index_country = document.getProp(\"userPreferences\", {\n                \"key\": \"WealthCalc_yuedongweng_currency_index\",\n                \"business\": \"WealthCalc\"\n            });\n\n            if (index_country) {\n                var jsonIndex = JSON.parse(index_country);\n                arrIndex[0] = arrName.indexOf(jsonIndex.name_a);\n                arrIndex[1] = arrName.indexOf(jsonIndex.name_b);\n            }\n            if ((arrIndex[0] == undefined || arrIndex[0] == -1) || (arrIndex[1] == undefined || arrIndex[1] == -1)) {\n                arrIndex[0] = 1;\n                arrIndex[1] = 0;\n            }\n\n            document.getElementById(\"label_a\").innerText = arrName[arrIndex[0]];\n            document.getElementById(\"label_b\").innerText = arrName[arrIndex[1]];\n\n            if (arrIcon[arrIndex[0]].length <= 0) {\n                if (document.platform == \"android\") {\n                    document.getElementById(\"img_a\").src = WealthCalc_bundle + arrIconCode[arrIndex[0]].toLowerCase();\n                } else {\n                    document.getElementById(\"img_a\").src = WealthCalc_bundle + arrIconCode[arrIndex[0]];\n                }\n            } else {\n                document.getElementById(\"img_a\").src = arrIcon[arrIndex[0]];\n            }\n\n            if (arrIcon[arrIndex[1]].length <= 0) {\n                if (document.platform == \"android\") {\n                    document.getElementById(\"img_b\").src = WealthCalc_bundle + arrIconCode[arrIndex[1]].toLowerCase();\n                } else {\n                    document.getElementById(\"img_b\").src = WealthCalc_bundle + arrIconCode[arrIndex[1]];\n                }\n            } else {\n                document.getElementById(\"img_b\").src = arrIcon[arrIndex[1]];\n            }\n\n            var rate = (arrRate[arrIndex[0]] / arrRate[arrIndex[1]]).toFixed(4);\n\n            document.getElementById(\"bottom_label\").innerText = \"1\" + arrLabel[0].innerText + \" = \" + rate + arrLabel[1].innerText + \",\" + \" {{更新于}} \" + currencyUpdateTime;\n        }\n\n        function initDefaultUI() {\n\n            document.getElementById(\"input_a\").focus();\n\n            arrInput.push(document.getElementById(\"input_a\"));\n            arrInput.push(document.getElementById(\"input_b\"));\n\n            arrLabel.push(document.getElementById(\"label_a\"));\n            arrLabel.push(document.getElementById(\"label_b\"));\n\n            arrImg.push(document.getElementById(\"img_a\"));\n            arrImg.push(document.getElementById(\"img_b\"));\n\n            //### 图片做跨平台处理\n            if (document.platform == \"iOS\") {\n                document.getElementById(\"img_arrow_a\").src = UICommon_bundle + \"Tables_Arrow\";\n                document.getElementById(\"img_arrow_b\").src = UICommon_bundle + \"Tables_Arrow\";\n\n                document.getElementById(\"img_a\").failurevalue = WealthCalc_bundle + \"countryLogoDefault\";\n                document.getElementById(\"img_b\").failurevalue = WealthCalc_bundle + \"countryLogoDefault\";\n            } else {\n                document.getElementById(\"img_arrow_a\").src = UICommon_bundle + \"tables_arrow\";\n                document.getElementById(\"img_arrow_b\").src = UICommon_bundle + \"tables_arrow\";\n\n                document.getElementById(\"img_a\").failurevalue = WealthCalc_bundle + \"default_icon\";\n                document.getElementById(\"img_b\").failurevalue = WealthCalc_bundle + \"default_icon\";\n            }\n\n\n        }\n\n        function init() {\n            initDefaultUI();\n            \n            var oldResult = document.getProp(\"userPreferences\", {\n                            \"key\": \"WealthCalc_yuedongweng_currency\",\n                            \"business\": \"WealthCalc\"\n                        });\n            if (oldResult) {\n                init_ui(JSON.parse(oldResult), true);\n            } else {\n                var defaultRpcResult = '{\"clientQueryTime\":\"2016-01-29 16:51:06\",\"currencyRateList\":[{\"currencyCode\":\"CNY\",\"currencyName\":\"人民币\",\"iconUrl\":\"\",\"rate\":\"1.0\",\"sortWeight\":1},{\"currencyCode\":\"USD\",\"currencyName\":\"美元\",\"iconUrl\":\"\",\"rate\":\"6.5878\",\"sortWeight\":2},{\"currencyCode\":\"HKD\",\"currencyName\":\"港币\",\"iconUrl\":\"\",\"rate\":\"0.845\",\"sortWeight\":3},{\"currencyCode\":\"TWD\",\"currencyName\":\"新台币\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201411/3kl2sfkNNV.png_[pixelWidth]x.png\",\"rate\":\"0.1958\",\"sortWeight\":4},{\"currencyCode\":\"MOP\",\"currencyName\":\"澳门元\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201410/3bHk0MXYs9.png_[pixelWidth]x.png\",\"rate\":\"0.8194\",\"sortWeight\":5},{\"currencyCode\":\"EUR\",\"currencyName\":\"欧元\",\"iconUrl\":\"\",\"rate\":\"7.2131\",\"sortWeight\":6},{\"currencyCode\":\"KRW\",\"currencyName\":\"韩元\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201410/3bHlAfnZm1.png_[pixelWidth]x.png\",\"rate\":\"0.005433\",\"sortWeight\":7},{\"currencyCode\":\"JPY\",\"currencyName\":\"日元\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J17HBoG3J.png_[pixelWidth]x.png\",\"rate\":\"0.055572\",\"sortWeight\":8},{\"currencyCode\":\"GBP\",\"currencyName\":\"英镑\",\"iconUrl\":\"\",\"rate\":\"9.4694\",\"sortWeight\":9},{\"currencyCode\":\"SGD\",\"currencyName\":\"新加坡元\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J18C27Car.png_[pixelWidth]x.png\",\"rate\":\"4.6249\",\"sortWeight\":10},{\"currencyCode\":\"THB\",\"currencyName\":\"泰铢\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201509/5lhRFrT3PB.png_[pixelWidth]x.png\",\"rate\":\"0.183\",\"sortWeight\":11},{\"currencyCode\":\"RUB\",\"currencyName\":\"俄罗斯卢布\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1Glr3GDd.png_[pixelWidth]x.png\",\"rate\":\"0.0855\",\"sortWeight\":12},{\"currencyCode\":\"AUD\",\"currencyName\":\"澳大利亚元\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1IMTCoUX.png_[pixelWidth]x.png\",\"rate\":\"4.6796\",\"sortWeight\":13},{\"currencyCode\":\"CAD\",\"currencyName\":\"加拿大元\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1J3XXydR.png_[pixelWidth]x.png\",\"rate\":\"4.7024\",\"sortWeight\":14},{\"currencyCode\":\"NOK\",\"currencyName\":\"挪威克朗\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1ETguATF.png_[pixelWidth]x.png\",\"rate\":\"0.7663\",\"sortWeight\":15},{\"currencyCode\":\"DKK\",\"currencyName\":\"丹麦克朗\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1FBxyBbh.png_[pixelWidth]x.png\",\"rate\":\"0.9677\",\"sortWeight\":16},{\"currencyCode\":\"NZD\",\"currencyName\":\"新西兰元\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1HdA4vdF.png_[pixelWidth]x.png\",\"rate\":\"4.2771\",\"sortWeight\":17},{\"currencyCode\":\"SEK\",\"currencyName\":\"瑞典克朗\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1MLxOkC5.png_[pixelWidth]x.png\",\"rate\":\"0.7763\",\"sortWeight\":18},{\"currencyCode\":\"CHF\",\"currencyName\":\"瑞士法郎\",\"iconUrl\":\"http://pic.alipayobjects.com/i/mobileapp/png/201408/3J1N2oiJZt.png_[pixelWidth]x.png\",\"rate\":\"6.5127\",\"sortWeight\":19},{\"currencyCode\":\"MYR\",\"currencyName\":\"马来西亚林吉特\",\"iconUrl\":\"https://zos.alipayobjects.com/mwalletmng/TYGBUTOcHwhWINP.png_[pixelWidth]x.png\",\"rate\":\"1.6091\",\"sortWeight\":20},{\"currencyCode\":\"VND\",\"currencyName\":\"越南盾\",\"iconUrl\":\"https://zos.alipayobjects.com/mwalletmng/xzucQMpyOOqzlLN.png_[pixelWidth]x.png\",\"rate\":\"2.9556\",\"sortWeight\":99},{\"currencyCode\":\"PHP\",\"currencyName\":\"菲律宾比索\",\"iconUrl\":\"https://zos.alipayobjects.com/mwalletmng/xirkwGOdfmoOBQl.png_[pixelWidth]x.png\",\"rate\":\"0.1423\",\"sortWeight\":99},{\"currencyCode\":\"KHR\",\"currencyName\":\"柬埔寨瑞尔\",\"iconUrl\":\"https://zos.alipayobjects.com/mwalletmng/pBqQmIbnIJfzAWw.png_[pixelWidth]x.png\",\"rate\":\"0.0016\",\"sortWeight\":99},{\"currencyCode\":\"IDR\",\"currencyName\":\"印尼卢比\",\"iconUrl\":\"https://zos.alipayobjects.com/mwalletmng/tlEggTszDOIYThw.png_[pixelWidth]x.png\",\"rate\":\"0.0493\",\"sortWeight\":99}],\"currencyUpdateTime\":\"2016-01-29 09:37:09\",\"resultCode\":\"6000\",\"resultDesc\":\"汇率更新成功\",\"resultView\":\"汇率更新成功\",\"showType\":0,\"success\":true}';\n                init_ui(JSON.parse(defaultRpcResult), true);\n            }\n            \n            \n            document.invoke(\"rpc\", {\n                \"operationType\": \"alipay.mwealth.toolkit.currency.rate.queryAll\",\n                \"requestData\": [{}]\n            }, function (rsp) {\n\n                if (rsp.success) {\n\n                    var bizResult = rsp.result;\n\n                    if (bizResult.success) {\n\n                        init_ui(bizResult, false);\n\n                        document.setProp(\"userPreferences\", {\n                            \"key\": \"WealthCalc_yuedongweng_currency\",\n                            \"business\": \"WealthCalc\",\n                            \"data\": bizResult\n                        });\n                    } \n                }\n            });\n        }\n\n        function keydown_a() {\n\n            if (event.which == 10) {\n                document.getElementById(\"input_b\").focus();\n            }\n        }\n\n        function keydown_b() {\n\n            if (event.which == 10) {\n                document.getElementById(\"input_b\").blur();\n            }\n        }\n\n        document.viewDidAppear = function () {\n            if (document.platform == \"android\") {\n                document.getElementById(\"input_a\").focus();\n            }\n        }","tag":"text"}]}]},{"id":"bodyid","style":"flex-direction:column; height:100%; background-color:#f5f5f9;overflow:scroll;","onload":"init();","tag":"body","children":[{"style":"background-color:#ffffff; flex-direction:column;","tag":"div","children":[{"tag":"div","children":[{"style":"width:125px; height:80px;","tag":"div","children":[{"style":"padding-top:12px; padding-left:15px;","tag":"div","children":[{"style":"flex-direction:column; align-items:center;width:93px;","tag":"div","children":[{"id":"img_a","style":"width:60px; height:40px;","tag":"img","srcheight":"128","srcwidth":"128"},{"id":"label_a","style":"color:#808080; font-size:13px; margin-top:5px;","tag":"label"}]},{"id":"img_arrow_a","style":"width:9px; height:13px; margin-left:2px; margin-top:13px;","tag":"img"}]}],"onclick":"change_a();"},{"style":"width:1PX; background-color:#e5e5e5;margin:8px 0px;","tag":"div"},{"style":"flex:1; padding-right:16px;","tag":"div","children":[{"id":"input_a","style":"flex:1; text-align:right; font-size:18px;","placeholder":"{{请输入金额}}","tag":"input","onkeydown":"keydown_a()","onfocus":"focus_a()","type":"money","oninput":"money_input_a()"}]}]},{"style":"height:1PX; background-color:#e5e5e5;","tag":"div"},{"tag":"div","children":[{"style":"width:125px; height:80px;","tag":"div","children":[{"style":"padding-top:12px; padding-left:15px;","tag":"div","children":[{"style":"flex-direction:column; align-items:center;width:93px;","tag":"div","children":[{"id":"img_b","style":"width:60px; height:40px;","tag":"img","srcheight":"128","srcwidth":"128"},{"id":"label_b","style":"color:#808080; font-size:13px; margin-top:5px;","tag":"label"}]},{"id":"img_arrow_b","style":"width:9px; height:13px; margin-left:2px; margin-top:13px;","tag":"img"}]}],"onclick":"change_b();"},{"style":"width:1PX; background-color:#e5e5e5;margin:8px 0px;","tag":"div"},{"style":"flex:1; padding-right:16px;","tag":"div","children":[{"id":"input_b","style":"flex:1; text-align:right; font-size:18px;","placeholder":"{{请输入金额}}","tag":"input","value":"0","onkeydown":"keydown_b()","onfocus":"focus_b()","type":"money","oninput":"money_input_b()"}]}]},{"style":"height:1PX; background-color:#e5e5e5;","tag":"div"}]},{"id":"bottom_label","style":"margin-top:10px; color:#333333; font-size:12px; align-self:center;","tag":"label"},{"id":"bottom_label","style":"margin-top:5px; color:#999999; font-size:12px; align-self:center;","tag":"label","children":[{"text":"{{数据仅供参考，交易时以银行柜台成交价为准}}","tag":"text"}]}]}]},"format":"JSON","tplVersion":"5.0.3"}